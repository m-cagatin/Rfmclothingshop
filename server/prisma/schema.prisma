generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model RefreshToken {
  id        String    @id
  tokenHash String
  expiresAt DateTime
  revokedAt DateTime?
  userId    String
  createdAt DateTime  @default(now())
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "RefreshToken_userId_fkey")
}

model User {
  id             String         @id
  name           String
  email          String         @unique
  phone          String?
  passwordHash   String?
  role           User_role      @default(customer)
  emailVerified  Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @default(now())
  googleId       String?        @unique
  profilePicture String?
  RefreshToken   RefreshToken[]
}

model Users {
  UserId       Int        @id @default(autoincrement())
  FullName     String     @db.VarChar(255)
  Email        String     @unique(map: "Email") @db.VarChar(255)
  Phone        String?    @db.VarChar(20)
  PasswordHash String?    @default("\\") @db.VarChar(255)
  Roles        Json
  Status       String?    @default("Active") @db.VarChar(20)
  hired_date   DateTime?  @db.Date
  last_login   DateTime?  @db.Timestamp(0)
  created_at   DateTime?  @default(now()) @db.Timestamp(0)
  update_at    DateTime?  @default(now()) @db.Timestamp(0)
  payments     payments[]
}

model canvases {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(255)
  canvas_data Json
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  updated_at  DateTime? @default(now()) @db.Timestamp(0)

  @@index([created_at], map: "idx_created_at")
  @@index([name], map: "idx_name")
}

model cart_items {
  cart_item_id       Int               @id @default(autoincrement())
  customer_id        Int
  product_id         Int
  product_name       String            @db.VarChar(255)
  quantity           Int               @default(1)
  size               String?           @db.VarChar(20)
  color              String?           @db.VarChar(50)
  unit_price         Decimal           @db.Decimal(10, 2)
  customization_data Json?
  created_at         DateTime?         @default(now()) @db.Timestamp(0)
  updated_at         DateTime?         @default(now()) @db.Timestamp(0)
  customer_accounts  customer_accounts @relation(fields: [customer_id], references: [CustomerId], onDelete: Cascade, onUpdate: NoAction, map: "cart_items_ibfk_1")
  catalog_clothing   catalog_clothing  @relation(fields: [product_id], references: [product_id], onDelete: NoAction, onUpdate: NoAction, map: "cart_items_ibfk_2")

  @@unique([customer_id, product_id, size, color], map: "unique_cart_item")
  @@index([customer_id], map: "idx_customer_id")
  @@index([product_id], map: "product_id")
}

model catalog_clothing {
  product_id           Int                      @id @default(autoincrement())
  product_code         String?                  @unique(map: "product_code") @db.VarChar(8)
  product_name         String                   @unique(map: "product_name") @db.VarChar(255)
  category             String                   @db.VarChar(100)
  base_price           Decimal                  @db.Decimal(10, 2)
  description          String?                  @db.Text
  status               catalog_clothing_status? @default(Active)
  stock_quantity       Int?                     @default(0)
  sku                  String?                  @unique(map: "sku") @db.VarChar(100)
  sizes                Json?
  tags                 Json?
  created_at           DateTime?                @default(now()) @db.Timestamp(0)
  updated_at           DateTime?                @default(now()) @db.Timestamp(0)
  colors               Json?
  material             String?                  @db.VarChar(100)
  gender               catalog_clothing_gender? @default(Unisex)
  stock_by_size_color  Json?
  allows_customization Boolean?                 @default(true)
  customization_areas  Json?
  production_days      Int?                     @default(3)
  cart_items           cart_items[]
  order_items          order_items[]
  product_images       product_images[]

  @@index([category], map: "idx_category")
  @@index([product_name], map: "idx_product_name")
  @@index([status], map: "idx_status")
}

model customer_accounts {
  CustomerId             Int                                       @id @default(autoincrement())
  CustomerFullName       String                                    @db.VarChar(255)
  CustomerEmail          String                                    @unique(map: "CustomerEmail") @db.VarChar(255)
  CustomerPhone          String?                                   @unique(map: "CustomerPhone") @db.VarChar(20)
  CustomerPasswordHash   String                                    @db.Char(60)
  CustomerAddress        String?                                   @db.Text
  created_at             DateTime?                                 @default(now()) @db.Timestamp(0)
  last_login             DateTime?                                 @db.Timestamp(0)
  CustomerCity           String?                                   @db.VarChar(100)
  CustomerProvince       String?                                   @db.VarChar(100)
  CustomerPostalCode     String?                                   @db.VarChar(20)
  DateOfBirth            DateTime?                                 @db.Date
  EmergencyContactName   String?                                   @db.VarChar(255)
  EmergencyContactPhone  String?                                   @db.VarChar(20)
  MarketingConsent       Boolean?                                  @default(false)
  CustomerCountry        String?                                   @default("Philippines") @db.VarChar(100)
  PreferredContactMethod customer_accounts_PreferredContactMethod? @default(email)
  cart_items             cart_items[]
  orders                 orders[]
}

model customizable_product_images {
  image_id              Int                                    @id @default(autoincrement())
  product_id            Int
  image_url             String                                 @db.VarChar(500)
  cloudinary_public_id  String?                                @db.VarChar(255)
  image_type            customizable_product_images_image_type
  display_order         Int                                    @default(1)
  created_at            DateTime?                              @default(now()) @db.Timestamp(0)
  customizable_products customizable_products                  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "customizable_product_images_ibfk_1")

  @@unique([product_id, image_type, display_order], map: "unique_product_type_display")
  @@index([image_type], map: "idx_image_type")
  @@index([product_id], map: "idx_product_id")
}

model customizable_product_stock {
  id                    Int                   @id @default(autoincrement())
  product_id            Int
  size                  String                @db.VarChar(50)
  color                 String                @db.VarChar(100)
  quantity              Int?                  @default(0)
  created_at            DateTime?             @default(now()) @db.Timestamp(0)
  updated_at            DateTime?             @default(now()) @db.Timestamp(0)
  customizable_products customizable_products @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "customizable_product_stock_ibfk_1")

  @@unique([product_id, size, color], map: "unique_stock")
  @@index([product_id], map: "idx_product_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model customizable_products {
  id                          Int                                         @id @default(autoincrement())
  product_code                String?                                     @unique(map: "product_code") @db.VarChar(8)
  name                        String                                      @db.VarChar(255)
  category                    String                                      @db.VarChar(100)
  gender                      customizable_products_gender?               @default(Unisex)
  fit_type                    customizable_products_fit_type?             @default(Classic)
  description                 String?                                     @db.Text
  fabric_composition          String?                                     @db.VarChar(255)
  fabric_weight               String?                                     @db.VarChar(100)
  texture                     String?                                     @db.VarChar(100)
  available_sizes             Json?
  fit_description             String?                                     @db.VarChar(255)
  size_pricing                Json?
  color_name                  String?                                     @db.VarChar(100)
  color_hex                   String?                                     @db.VarChar(7)
  variant_name                String?                                     @db.VarChar(255)
  variant_image_url           String?                                     @db.VarChar(500)
  variant_image_public_id     String?                                     @db.VarChar(500)
  print_method                customizable_products_print_method?         @default(DTG)
  print_areas                 Json?
  design_requirements         String?                                     @db.Text
  base_cost                   Decimal?                                    @default(0.00) @db.Decimal(10, 2)
  retail_price                Decimal?                                    @default(0.00) @db.Decimal(10, 2)
  turnaround_time             String?                                     @db.VarChar(100)
  minimum_order_qty           Int?                                        @default(1)
  created_at                  DateTime?                                   @default(now()) @db.Timestamp(0)
  updated_at                  DateTime?                                   @default(now()) @db.Timestamp(0)
  front_print_cost            Decimal?                                    @default(0.00) @db.Decimal(10, 2)
  back_print_cost             Decimal?                                    @default(0.00) @db.Decimal(10, 2)
  size_availability           Json?
  differentiation_type        customizable_products_differentiation_type? @default(none)
  status                      customizable_products_status?               @default(active)
  customizable_product_images customizable_product_images[]
  customizable_product_stock  customizable_product_stock[]

  @@index([category], map: "idx_category")
  @@index([color_name], map: "idx_color_name")
  @@index([gender], map: "idx_gender")
  @@index([variant_name], map: "idx_variant_name")
}

model expenses {
  expenseId     Int       @id @default(autoincrement())
  date          DateTime  @db.Date
  description   String    @db.VarChar(255)
  category      String?   @db.VarChar(50)
  amount        Decimal   @db.Decimal(10, 2)
  vendor        String?   @db.VarChar(100)
  paymentMethod String?   @db.VarChar(50)
  createdAt     DateTime? @default(now()) @db.Timestamp(0)
}

model order_items {
  item_id            Int              @id @default(autoincrement())
  order_id           Int
  product_id         Int
  product_name       String           @db.VarChar(255)
  quantity           Int
  size               String?          @db.VarChar(20)
  color              String?          @db.VarChar(50)
  unit_price         Decimal          @db.Decimal(10, 2)
  subtotal           Decimal          @db.Decimal(10, 2)
  customization_data Json?
  created_at         DateTime?        @default(now()) @db.Timestamp(0)
  orders             orders           @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction, map: "order_items_ibfk_1")
  catalog_clothing   catalog_clothing @relation(fields: [product_id], references: [product_id], onDelete: NoAction, onUpdate: NoAction, map: "order_items_ibfk_2")

  @@index([order_id], map: "order_id")
  @@index([product_id], map: "product_id")
}

model orders {
  order_id                             Int               @id @default(autoincrement())
  order_ref                            String            @unique(map: "order_ref") @db.VarChar(50)
  customer_id                          Int
  customer_name                        String            @db.VarChar(255)
  customer_email                       String            @db.VarChar(255)
  customer_phone                       String?           @db.VarChar(20)
  customer_address                     String?           @db.Text
  total_amount                         Decimal           @db.Decimal(10, 2)
  payment_id                           Int?
  status                               orders_status?    @default(payment_pending)
  order_date                           DateTime?         @default(now()) @db.Timestamp(0)
  estimated_completion                 DateTime?         @db.Date
  notes                                String?           @db.Text
  created_at                           DateTime?         @default(now()) @db.Timestamp(0)
  updated_at                           DateTime?         @default(now()) @db.Timestamp(0)
  order_items                          order_items[]
  customer_accounts                    customer_accounts @relation(fields: [customer_id], references: [CustomerId], onDelete: NoAction, onUpdate: NoAction, map: "orders_ibfk_1")
  payments_orders_payment_idTopayments payments?         @relation("orders_payment_idTopayments", fields: [payment_id], references: [payment_id], onDelete: NoAction, onUpdate: NoAction, map: "orders_ibfk_2")
  payments_payments_order_idToorders   payments[]        @relation("payments_order_idToorders")

  @@index([customer_id], map: "idx_customer_id")
  @@index([order_date], map: "idx_order_date")
  @@index([status], map: "idx_status")
  @@index([payment_id], map: "payment_id")
}

model payments {
  payment_id                         Int                      @id @default(autoincrement())
  order_id                           Int
  payment_method                     payments_payment_method
  payment_status                     payments_payment_status? @default(pending)
  amount                             Decimal                  @db.Decimal(10, 2)
  paymongo_payment_id                String?                  @db.VarChar(255)
  paymongo_payment_intent_id         String?                  @db.VarChar(255)
  paymongo_link_url                  String?                  @db.VarChar(500)
  paymongo_link_id                   String?                  @db.VarChar(255)
  payment_proof_url                  String?                  @db.VarChar(500)
  cloudinary_public_id               String?                  @db.VarChar(255)
  reference_number                   String?                  @db.VarChar(100)
  verified_by                        Int?
  verified_at                        DateTime?                @db.Timestamp(0)
  paid_at                            DateTime?                @db.Timestamp(0)
  created_at                         DateTime?                @default(now()) @db.Timestamp(0)
  updated_at                         DateTime?                @default(now()) @db.Timestamp(0)
  orders_orders_payment_idTopayments orders[]                 @relation("orders_payment_idTopayments")
  orders_payments_order_idToorders   orders                   @relation("payments_order_idToorders", fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction, map: "payments_ibfk_1")
  Users                              Users?                   @relation(fields: [verified_by], references: [UserId], onDelete: NoAction, onUpdate: NoAction, map: "payments_ibfk_2")

  @@index([created_at], map: "idx_created_at")
  @@index([payment_method], map: "idx_method")
  @@index([order_id], map: "idx_order_id")
  @@index([paymongo_payment_id], map: "idx_paymongo_payment_id")
  @@index([payment_status], map: "idx_status")
  @@index([verified_by], map: "verified_by")
}

model product_images {
  image_id             Int              @id @default(autoincrement())
  product_id           Int
  image_url            String           @db.VarChar(500)
  cloudinary_public_id String?          @db.VarChar(255)
  display_order        Int              @default(1)
  created_at           DateTime?        @default(now()) @db.Timestamp(0)
  catalog_clothing     catalog_clothing @relation(fields: [product_id], references: [product_id], onDelete: Cascade, onUpdate: NoAction, map: "product_images_ibfk_1")

  @@unique([product_id, display_order], map: "unique_product_display")
  @@index([display_order], map: "idx_display_order")
  @@index([product_id], map: "idx_product_id")
}

enum payments_payment_method {
  paymongo
  gcash
  bank_transfer
  cod
}

enum payments_payment_status {
  pending
  paid
  failed
  refunded
}

enum customizable_product_images_image_type {
  front
  back
  additional
}

enum customizable_products_gender {
  Unisex
  Men
  Women
  Kids
}

enum User_role {
  customer
  admin
}

enum customizable_products_fit_type {
  Classic
  Slim_Fit     @map("Slim Fit")
  Regular_Fit  @map("Regular Fit")
  Relaxed_Fit  @map("Relaxed Fit")
  Oversized
  Tapered
  Athletic_Fit @map("Athletic Fit")
  Muscle_Fit   @map("Muscle Fit")
}

enum catalog_clothing_status {
  Active
  Inactive
  Archived
}

enum orders_status {
  payment_pending
  pending
  designing
  ripping
  heatpress
  cutting
  assembly
  qc
  done
  cancelled
}

enum catalog_clothing_gender {
  Men
  Women
  Unisex
  Kids
}

enum customer_accounts_PreferredContactMethod {
  email
  phone
  sms
}

enum customizable_products_print_method {
  DTG
  Screen_Print @map("Screen Print")
  Embroidery
}

enum customizable_products_differentiation_type {
  none
  color
  variant
}

enum customizable_products_status {
  active
  inactive
  archived
}
